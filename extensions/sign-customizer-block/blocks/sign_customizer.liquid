{% schema %}
{
  "name": "Sign Customizer",
  "target": "section",
  "settings": [
    {
      "type": "text",
      "id": "customizer_id",
      "label": "Sign Customizer ID",
      "info": "Enter the ID of the sign customizer to display from your app. Find this in the Customizers page of the app."
    },
    {
      "type": "checkbox",
      "id": "use_iframe",
      "label": "Use iframe (experimental)",
      "info": "Render your customizer in an iframe instead of embedding directly on your shop page.",
      "default": false
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "Customize Signage"
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "Button Style",
      "options": [
        {
          "value": "primary",
          "label": "Primary"
        },
        {
          "value": "secondary",
          "label": "Secondary"
        }
      ],
      "default": "primary"
    }
  ]
}
{% endschema %}

{% if block.settings.customizer_id != blank %}
  <div class="sign-customizer-container" data-customizer-id="{{ block.settings.customizer_id }}">
    <button
      class="signage-customizer-btn sign-customizer-button--{{ block.settings.button_style }}"
      data-customizer-id="{{ block.settings.customizer_id }}"
      data-product-id="{{ product.id }}"
    >
      {{ block.settings.button_text }}
    </button>
  </div>

  <script>
    (function() {
      const customizerId = '{{ block.settings.customizer_id }}';
      const appUrl = '{{ shop.url }}/apps/{{ app.handle }}';

      if (!document.querySelector('script[data-sign-customizer-loaded]')) {
        const script = document.createElement('script');
        script.src = appUrl + '/embed/{{ shop.permanent_domain }}';
        script.setAttribute('data-sign-customizer-loaded', 'true');
        script.defer = true;
        document.body.appendChild(script);
      }
    })();
  </script>

  <style>
    .sign-customizer-container {
      margin: 1rem 0;
    }

    .sign-customizer-button--primary {
      background-color: #000;
      color: #fff;
      border: none;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 4px;
      cursor: pointer;
      transition: opacity 0.2s;
    }

    .sign-customizer-button--primary:hover {
      opacity: 0.9;
    }

    .sign-customizer-button--secondary {
      background-color: transparent;
      color: #000;
      border: 2px solid #000;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: 600;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s;
    }

    .sign-customizer-button--secondary:hover {
      background-color: #000;
      color: #fff;
    }
  </style>
{% else %}
  <div class="sign-customizer-placeholder" style="padding: 20px; background: #f5f5f5; border: 2px dashed #ccc; text-align: center;">
    <p style="margin: 0; color: #666;">
      Please configure the Sign Customizer ID in the theme editor settings.
    </p>
  </div>
{% endif %}
